\section{Implementación de la solución}
En esta sección, se detalla el proceso de desarrollo de la propuesta. Para ello, se escogerán algunas funcionalidades que serán utilizadas como casos de prueba, con el fin de describir las actividades realizadas durante la implementación.

\subsection{Planificación}

Para llevar a cabo el desarrollo del proyecto se opto por la metodología iterativa e incremental. La planificación resultante seguida durante el desarrollo del proyecto se muestra en el Cuadro \ref{fig:planificacion} .

\begin{table}
  \begin{center}
    \begin{tabular}{||c| m{6cm}| m{2.5cm}| m{2.5cm}||} 
      \hline
      N° Iteración & Tareas & Fecha Inicio & Fecha \newline término \\ [0.5ex] 
      \hline\hline
      1 & - Especificación de requisitos \newline - Escoger arquitectura lógica y física & 26/08/2019 & 14/10/2019 \\ 
      \hline
      2 & - Implementar problema monoobjetivo (Pipe Optimizing) \newline - Implementar algoritmo genético \newline - Implementar operadores de selección y reproducción & 14/10/2019 & 11/11/2019 \\
      \hline
      3 & - Crear interfaces de usuario \newline - Guardar soluciones & 11/11/2019 & 20/01/2020 \\
      \hline
      4 & - Implementar problema multiobjetivo (Pumping Scheduling) \newline - Implementar algoritmo NSGAII & 27/01/2020 & 24/02/2020 \\
      \hline
      5 & - Permitir realizar multiples repeticiones de un algoritmo \newline - Permitir realizar la simulación usando los valores por defecto de la red & 02/03/2020 & 04/05/2020 \\ [1ex] 
      \hline
      6 & - Agregar simbolos al dibujo de la red \newline - Exportar a excel \newline - Agregar menu de configuración & 11/05/2020 & 08/06/2020 \\ [1ex] 
      \hline
    \end{tabular}
   \caption{Planificación de las iteraciones}
   \label{fig:planificacion}
 \end{center}
\end{table}

\subsection{Aplicación de la metodología}

En esta sección se da a conocer como se lleva a cabo la aplicación de la metodología en el desarrollo del proyecto. Para esto, se presentará por cada una de las fases del desarrollo las actividades realizadas en cada iteración. 

\subsubsection{Casos de prueba}

Los casos de prueba son las funcionalidades que se usarán para presentar y demostrar la aplicación de la metodología durante el desarrollo del proyecto.

Se escogerán 3 funcionalidades de prueba las cuales son:

\paragraph{Funcionalidad 1:} El sistema debe poder visualizar la red.\\
Esta funcionalidad consiste en visualizar gráficamente la forma de la red cargada. El archivo de descripción de red debe ser creado desde la aplicación Epanet y tener la extensión inp.

\paragraph{Funcionalidad 2:} El sistema debe poder buscar soluciones al problema de la optimización de los costos de construcción de las tuberías usando el algoritmo genético.\\
Esta funcionalidad consiste en buscar soluciones para el problema de optimización de los costos de construcción de las tuberías.

\paragraph{Funcionalidad 3:}  El sistema debe poder realizar una simulación hidráulica utilizando los valores por defecto del archivo de red.\\
Esta funcionalidad consiste en realizar una simulación hidráulica utilizando el archivo de red cargado y visualizar los valores resultantes de los elementos de la red.

\subsubsection{Requisitos}

Durante la fase de requisitos se llevo a cabo la captura, priorización, validación y la especificación formal de requisitos.

Los requisitos iniciales de la aplicación fueron capturados del profesor Jimmy Gutierrez. Posteriormente, estos requisitos fueron priorizados y validados para finalmente ser documentados en el documento de especificación formal de requisitos. 

A medida que avanzaban las iteraciónes algunos requisitos fueron cambiando o fueron surgiendo requisitos nuevos. En el Cuadro \ref{fig:cambios_requisitos} se detallan los cambios y actividades realizados durante cada iteración.

\begin{table}
  \begin{center}
    \begin{tabular}{||c| m{2cm}| m{8cm}||} 
      \hline
      N° Iteración & Requisitos cubiertos & Tareas\\ [0.5ex] 
      \hline\hline
      1 & 5/32 & Se capturan 5 requisitos.\newline Se crea el informe de especificación de requisitos. \\
      \hline
      2 & 11/32 & Se capturan 6 nuevos requisitos. \newline Se actualiza el documento de requisitos.\\
      \hline
      3 & 16/32 & Se capturan 5 nuevos requisitos. \newline Se actualiza el documento de requisitos. \\
      \hline
      4 & 20/32 & Se capturan 4 nuevos requisitos.\newline Se actualiza el documento de requisitos. \\
      \hline
      5 & 20/32 & No hay nuevos requisitos. \\
      \hline
      6 & 32/32 & Se capturan 12 nuevos requisitos.\newline Se actualiza el documento de requisitos. \\
      \hline

    \end{tabular}
   \caption{Actividades y cambios de la fase de requisitos durante cada iteración}
   \label{fig:cambios_requisitos}
 \end{center}
\end{table}

Los cuadros \ref{fig:RU004}, \ref{fig:RU003} y \ref{fig:RU020} muestran la especificación formal de los requisitos relacionados a las funcionalidades escogidas anteriormente.

\begin{table}
  \begin{center}
    \begin{tabular}{||m{12cm}||} 
      \hline
      \textbf{RU004 -- Visualizar red en una interfaz gráfica.}\\
      \hline
      \textbf{Descripción:}  Se debe mostrar en la interfaz gráfica una representación de la red (Un dibujo, etc) generada a partir de la información contenida en el archivo inp.\\
      \hline
      \textbf{Fuente:} Jimmy Gutiérrez\\
      \hline
      \textbf{Prioridad:} Crítica\\
      \hline
      \textbf{Estabilidad:} Intransable\\
      \hline
      \textbf{Fecha de actualización:} 09/09/2019\\
      \hline
      \textbf{Estado:} Cumple\\
      \hline
      \textbf{Incremento:} 3\\
      \hline
      \textbf{Tipo:} Funcional\\
      \hline
    \end{tabular}
   \caption{Especificación del requisito de usuario RU004.}
   \label{fig:RU004}
 \end{center}
\end{table}

\begin{table}
  \begin{center}
    \begin{tabular}{||m{12cm}||} 
      \hline
      \textbf{RU003 -- Resolver el problema multiobjetivo (Pumping Scheduling) usando el Algoritmo NSGA-II.}\\
      \hline
      \textbf{Descripción:}  El algoritmo NSGA-II debe ser aplicado al problema multiobjetivo cuyas funciones a optimizar son los costos energéticos y el número de encendido y apagado de las bombas (Pumping Schedule).\\
      \hline
      \textbf{Fuente:} Jimmy Gutiérrez\\
      \hline
      \textbf{Prioridad:} Crítica\\
      \hline
      \textbf{Estabilidad:} Intransable\\
      \hline
      \textbf{Fecha de actualización:} 09/09/2019\\
      \hline
      \textbf{Estado:} Cumple\\
      \hline
      \textbf{Incremento:} 4\\
      \hline
      \textbf{Tipo:} Funcional\\
      \hline
    \end{tabular}
   \caption{Especificación del requisito de usuario RU003.}
   \label{fig:RU003}
 \end{center}
\end{table}

\begin{table}
  \begin{center}
    \begin{tabular}{||m{12cm}||} 
      \hline
      \textbf{RU020 -- Permitir realizar simulaciones hidráulicas utilizando los valores por defectos que vienen en el archivo .inp y visualizar los resultados.}\\
      \hline
      \textbf{Descripción:}  Utilizando los valores que vienen por defecto en el archivo inp se debe poder llevar a cabo la simulación hidráulica de la red. Posteriormente, los resultados podrán ser visualizados por el usuario.\\
      \hline
      \textbf{Fuente:} Daniel Mora-Meliá\\
      \hline
      \textbf{Prioridad:} Crítica\\
      \hline
      \textbf{Estabilidad:} Intransable\\
      \hline
      \textbf{Fecha de actualización:} 27/01/2020\\
      \hline
      \textbf{Estado:} Cumple\\
      \hline
      \textbf{Incremento:} 5\\
      \hline
      \textbf{Tipo:} Funcional\\
      \hline
    \end{tabular}
   \caption{Especificación del requisito de usuario RU020.}
   \label{fig:RU020}
 \end{center}
\end{table}


La especificación formal de los requisitos restantes se encuentra en el \textbf{Anexo A}.


\subsubsection{Diseño}

Una vez terminada la fase de requisitos se procede a diseñar la aplicación. Dentro del diseño, se encuentran las tareas de escoger  y documentar la arquitectura física y lógica, realizar los diagramas de clases, diagramas de secuencia, diseño de interfaces, entre otros.

Mientras avanzaba el desarrollo fue necesario ir modificando el documento de diseño debido a la aparición o al cambio de requisitos, así como la realización de mejoras en los diagramas realizados. En el Cuadro \ref{fig:cambios_diseno} se presentan más detalladamente los cambios realizados en cada iteración.

\begin{table}
  \begin{center}
    \begin{tabular}{||c| m{6cm}| m{6cm}||} 
      \hline
      N° Iteración & Tareas & Descripción\\ [0.5ex] 
      \hline\hline
      1 & Crear arquitectura lógica. \newline Crear arquitectura física. \newline Diseñar módulos.\newline Crear diagrama de clases del modulo metaheurística. \newline Crear diagrama de clases del la representación de la red.
      &\\
      \hline
      2 & No hubieron cambios & \\
      \hline
      3 & Diseñar interfaces de usuario.\newline Especificar detalles de la implementación referente a las anotaciones de java (Java Annotations).\newline Generar diagrama de secuencia de optimización. & \\
      \hline
      4 & No hubieron cambios & \\
      \hline
      5 & Modificar interfaces de usuario. \newline Crear diagrama de secuencia para realizar la simulación usando las configuraciones por defecto. Modificar y mejora del diagrama de secuencia de la optimización. & \\
      \hline
      6 & Modificar y mejora del diagrama de secuencia de la optimización. & Se modifico el diagrama de secuencia de la optimización debido a la aparición de un nuevo requisito.  \\
      \hline
    \end{tabular}
   \caption{Actividades y cambios de la fase de requisitos durante cada iteración}
   \label{fig:cambios_diseno}
 \end{center}
\end{table}

Como una de las primeras tareas realizadas durante esta fase se procedió a definir la arquitectura de la aplicación, tanto desde el punto físico como el lógico. 

La arquitectura física del programa a desarrollar es la arquitectura monolítica, cuya característica es que software que posee esta arquitectura funciona localmente sin necesidad de interactuar con otros equipos. Esta elección se debe a que en reuniones con el cliente se estableció que el programa será usado localmente y debe operar sobre el sistema operativo Windows. Limitación debida principalmente al acceso a funciones nativas cuando se realizan simulaciones hidráulicas utilizando la  librería dinámica de Epanet. La Figura \ref{fig:arq_fisica} muestra el diagrama de la arquitectura monolítica.

\begin{figure}[H]
	\includegraphics[width=0.5\textwidth]{Capitulo3/assets/arquitectura_fisica.png}
	\centering
	\caption{Arquitectura monolítica}
	\label{fig:arq_fisica}
\end{figure}

En cuanto a la arquitectura lógica se escogió utilizar Modelo-Vista-Controlador. Ésta elección se debe al hecho de que dicha arquitectura nos permite separar la capa de interfaz de usuario de la lógica de la aplicación mejorando asi escalabilidad y mantenibilidad del software. La Figura \ref{fig:arq_logica} muestra el diagrama de la arquitectura lógica, así como los principales módulos de la aplicación.

\begin{figure}[H]
  \includegraphics[width=\textwidth]{Capitulo3/assets/arquitectura_logica.eps}
	\centering
	\caption{Arquitectura monolítica}
	\label{fig:arq_logica}
\end{figure}

A continuación se presentarán los diseños relaciónados por cada una de las funcionalidades escogidas con anterioridad.

\paragraph{Funcionalidad 1:} Para implementar esta funcionalidad es necesario abstraer en un conjunto de clases los datos almacenados en el archivo de configuración de red. La Figura \ref{fig:dia_clase_network} muestra el diagrama de clases de las clases sobre la que almacenan los datos al momento de cargar la red. 


\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/d_clases_network.eps}
	\caption{Diagrama de clases de la abstracción de la red.}
	\label{fig:dia_clase_network}
\end{figure}

El diagrama de la Figura \ref{fig:dia_sec_visualizacion} muestra el conjunto de clases y los mensajes de la clases que interactúan con la clase \textit{Network} con el fin de visualizar la red. 

\begin{figure}[h]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/d_sec_visualizacion.eps}
	\caption{Diagrama de secuencia de la carga y visualización de la red.}
	\label{fig:dia_sec_visualizacion}
\end{figure}

\paragraph{Funcionalidad 2:} Esta es una de las funcionalidades ligada al modulo metaheurística y debido a uno de los requisitos establecidos por el cliente de que la aplicación debe poder extender el número de algoritmos, operadores y problemas implementados es necesario implementar una jerarquía de clases que facilite lo anteriormente mencionado. Es por ello, que se utilizo como base la jerarquía de clases utilizada por el Framework JMetal~\cite{Durillo2010} la cual fue adaptada para ser ocupada por esta aplicación. La Figura \ref{fig:dia_class_met} corresponde a la jerarquía ya mencionada.


\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/d_clases_metaheuristica.eps}
	\caption{Diagrama de clases modulo metaheurística. Modificación a partir del diagrama presentado en \cite{Durillo2010}.}
	\label{fig:dia_class_met}
\end{figure}

El diagrama de secuencia de la Figura \ref{fig:dia_sec_opt} muestra la interacción de las clases con del modulo metaheurísticas, con el resto de clases de la aplicación.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/d_seq_simulacion-monomulti.eps}
	\caption{Diagrama de secuencia para llevar a cabo la optimizacion de los problemas.}
	\label{fig:dia_sec_opt}
\end{figure}

\paragraph{Funcionalidad 3:} Para implementar esta funcionalidad es necesario implementar un conjunto de clases las cuales guardaran los resultados de la simulación para cada uno de los nodos y enlaces de una red. Estas nuevas clases son las mostradas en la Figura \ref{fig:dia_class_sim_hyd}.


\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/d_clases_hyd_simulation.eps}
	\caption{Diagrama de clases para la simulación hidráulica}
	\label{fig:dia_class_sim_hyd}
\end{figure}

El diagrama de secuencia presentado en la Figura \ref{fig:dia_sec_sim_hyd} muestra la interacción entre las clases necesarias para realizar la simulación hidráulica utilizando los valores del archivo de red cargado.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/d_seq_simulacion-hidraulica.eps}
	\caption{Diagrama de secuencia para realizar la simulación hidráulica}
	\label{fig:dia_sec_sim_hyd}
\end{figure}

En el \textbf{Anexo B} se puede ver la el documento de diseño de la aplicación.

\subsubsection{Implementación}
Con la fase de diseño finalizada, se procede a realizar la fase de implementación. Durante esta fase se genera el código de la aplicación y se genera el manual de usuario.

La aplicación fue desarrollada en el lenguaje Java version 1.8. Con el fin de crear las interfaces de usuario se utilizo el Framework JavaFX.

En el cuadro \ref{fig:actualizacion_implementacion} se presenta las tareas realizadas durante esta fase del desarrollo del software.

\begin{longtable}{||c| m{10cm}||}
  \hline
  N° Iteración & Descripción\\ [0.5ex] 
  \hline\hline
  1 & Se codifican las clases para cargar la red \textit{Network}.\\
  \hline
  2 & Se codifican las clases del modulo metaheuristica. \newline Se implementa el algoritmo genético.\newline Se implementa la codificación del problema monoobjetivo \textit{Pipe Optimizing}. \newline Se implementan los operadores IntegerRandomMutation, SBXCrossover, IntegerPolinomialMutation, IntegerRangeRandomMutation y UniformSelection.\\
  \hline
  3 & Se implementan la interfaz de usuario principal. \newline Se implementa el componente para visualizar la red \newline Se implementa la interfaz de configuración del problema. \newline Se implementa la interfaz de visualización de resultados de optimización. \newline Se implementa la interfaz que muestra el gráfico con los resultados de la optimizacion. \newline Se implementa la funcionalidad para guardar las soluciones en TSV. \newline Se implementa funcionalidad para exportar la solución escogida como un inp(Formato del archivo de configuración de red). \\
  \hline
  4 & Se agrega el algoritmo NSGAII. \newline Se implementa la codificación del problema multiobjetivo \textbf{Pumping Scheduling}.\\
  \hline
  5 & Se modifican las clases y archivos relacionados a la interfaces de usuario. \newline Se implementa la funcionalidad para realizar múltiples simulaciones independientes de un mismo algoritmo para los problemas multiobjetivos (Experimentos). \newline Se implementa la funcionalidad para realizar la simulación usando los valores del archivo de red.\\
  \hline
  6 & Se modifica el componente de visualización de red para mostrar para cada tipo de elemento que conforma la red un símbolo distinto. \newline Se implementa funcionalidad para mostrar una leyenda de los símbolos. \newline Se implementa ventana de configuración de la aplicación. \newline Se implementa la funcionalidad para realizar múltiples simulaciones independientes para los problemas monoobjetivo (Se adapta para utilizar los Experimentos antes utilizados solo en problemas multiobjetivos).\newline Se permite agregar valores por defecto en la ventana de configuración del problemas. \newline Se implementa la funcionalidad para exportar resultados a un Excel.\\
  \hline

  \caption{Actividades fase de implementación}
  \label{fig:actualizacion_implementacion}
\end{longtable}

A continuación se presentara para cada una de las funcionalidades escogidas las interfaces implementadas.

\paragraph{Funcionalidad 1}: La Figura \ref{fig:ventana_visualizacion} muestra la ventana de visualización de la red.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/VisualizacionRed.png}
	\caption{Ventana principal de la aplicación donde se visualiza la red}
	\label{fig:ventana_visualizacion}
\end{figure}

\paragraph{Funcionalidad 2}: Las Figuras \ref{fig:ventana_descripcion}, \ref{fig:ventana_configuracion_problema}, \ref{fig:ventana_operador}, \ref{fig:ventana_retroalimentacion} y \ref{fig:ventana_resultados_opt} muestran las ventana utilizadas durante el cumplimiento de esta funcionalidad.

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/ConfiguracionProblema1.png}
	\caption{Ventana de descripción del problema.}
	\label{fig:ventana_descripcion}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/ConfiguracionProblema2.png}
	\caption{Ventana de configuración del problema.}
	\label{fig:ventana_configuracion_problema}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/ConfiguracionProblema3.png}
	\caption{Ventana de configuración de parámetros del operador \textit{UniformSelection}.}
	\label{fig:ventana_operador}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/VentanaDeEjecucionMono.png}
	\caption{Ventana del retroalimentación mostrada durante la ejecución.}
	\label{fig:ventana_retroalimentacion}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/VentanaDeResultadosMono.png}
	\caption{Ventana de resultados generada cuando termina la ejecución para el problema monoobjetivo Pipe Optimizing.}
	\label{fig:ventana_resultados_opt}
\end{figure}

\paragraph{Funcionalidad 3}: La Figura \ref{fig:ventana_simulacion_hyd} muestra la ventana con los resultados de una simulación hidráulica para la red cargada.


\begin{figure}[H]
  \centering
  \includegraphics[width=\textwidth]{Capitulo3/assets/VentanaDeSimulacionHidraulica.png}
	\caption{Ventana de simulación hidráulica utilizando los valores del archivo de red.}
	\label{fig:ventana_simulacion_hyd}
\end{figure}

\subsubsection{Pruebas}


